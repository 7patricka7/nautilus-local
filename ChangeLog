2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* src/nautilus-first-time-druid.c:
	(nautilus_first_time_druid_show):
	Remove extra argument to update_draw_desktop_checkbox_state()
	which was delcared as () (instead of (void)) before the last
	change and so the build broke.
	
2001-04-23  Darin Adler  <darin@eazel.com>

	reviewed by: John Sullivan <sullivan@eazel.com>
	
	Add a new command-line option "--no-desktop" as requested by
	fcrozat on behalf of people who want to run Nautilus under KDE as
	well as under GNOME. The option has no effect if Nautilus is
	already running, but if it's the first invocation of Nautilus,
	then no desktop-related preferences show up and the desktop is
	not shown regardless of the setting of those preferences.
	
	* src/nautilus-main.c: (main): Add the no-desktop option. Make the
	desktop-related preferences invisible if it's on, and pass it down
	to the NautilusApplication.

	* src/nautilus-application.h:
	* src/nautilus-application.c: (nautilus_application_startup):
	Don't start the desktop if no_desktop is passed in. Otherwise
	decide based on the preference.

	* libnautilus-extensions/nautilus-preferences-box.c:
	(preferences_box_find_row): Mark this private function static.
	(preferences_box_populate_pane): Get rid of code that would
	translate the pane_name twice.
	(nautilus_preferences_dialog_new): Simplified this code a bit.
	
	* libnautilus-extensions/nautilus-preferences.h:
	* libnautilus-extensions/nautilus-preferences.c:
	(preferences_make_user_level_filtered_key),
	(nautilus_preferences_get_is_invisible),
	(nautilus_preferences_set_is_invisible),
	(preferences_key_make_for_getter),
	(nautilus_preferences_visible_in_current_user_level),
	(nautilus_preferences_is_visible): Added new flag to make a
	preference invisible.

	* src/nautilus-first-time-druid.h:
	* src/nautilus-first-time-druid.c: (set_up_gmc_transition_page),
	(nautilus_first_time_druid_show): Removed code that used to make
	the druid default based on the desktop preference.

	Fixed the Tinderbox.

	* libnautilus-extensions/nautilus-global-preferences.c:
	(default_default_folder_viewer_callback): Allow NULL because that
	happens during self-check.

2001-04-23  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (has_matching_uri),
	(compare_channel_names), (nautilus_news_add_channels),
	(add_site_from_fields), (determine_sort_position),
	(add_channel_entry), (make_remove_widgets):
	
	made it maintain the channel lists in alphabetical order, and
	improved uri matching by canonicalizing them before comparison.
		
	* components/news/news_channels.xml:
	added some new channels
	
	* nautilus-spec.in:
	added news panel to spec file.
	
2001-04-23  Andy Hertzfeld  <andy@eazel.com>

	made the disclosure triangles reflect the changed state by using
	different images when the channel changed; currently, I'm using
	placeholder images, but Arlo will give me the real ones soon.
		
	* components/news/nautilus-news-pixmaps.h:
	added images for triangles to reflect the changed state
	* components/news/nautilus-news.c: (do_destroy), (draw_triangle),
	(rss_logo_callback), (nautilus_news_load_images):
	load the new images, release on destroy, and display when appropriate
	
2001-04-23  John Sullivan  <sullivan@eazel.com>

	reviewed by: Darin Adler  <darin@eazel.com>

	Fixed bug 8024 (Default folder viewer chosen from "View As..."
	window is not reflected in Preferences dialog)

	* libnautilus-extensions/nautilus-global-preferences.h:
	Put iids for Icon and List view here since they must be accessed
	from multiple places now. Add NAUTILUS_DEFAULT_FOLDER_VIEWER_OTHER
	enum case. Add prototype for 
	nautilus_global_preferences_set_default_folder_viewer.
	
	* libnautilus-extensions/nautilus-global-preferences.c:
	(get_default_folder_viewer_preference_from_iid): New helper function,
	returns appropriate NAUTILUS_DEFAULT_FOLDER_VIEWER preference value
	based on folder-viewing iid.
	(default_default_folder_viewer_callback): New function to determine
	default value of NAUTILUS_DEFAULT_FOLDER_VIEWER preference; uses
	gnome_vfs_mime (name is not a typo).
	(set_default_folder_viewer_in_gnome_vfs): New function,
	updates gnome-vfs mime database properly for new folder-viewing iid.
	(default_folder_viewer_changed_callback): New function, reacts
	to change in NAUTILUS_DEFAULT_FOLDER_VIEWER preference by updating
	gnome-vfs mime database (moved here from nautilus-application.c).
	(nautilus_global_preferences_set_default_folder_viewer): New public
	function to set the default folder viewer with an iid; handles setting
	both gnome-vfs and gconf's values.
	(nautilus_global_preferences_initialize): Add callback for when
	default folder viewer changes (moved here from nautilus-application.c).
	
	* libnautilus-extensions/nautilus-program-chooser.c:
	(set_default_for_type): Special-case folder viewer to call
	nautilus_global_preferences_set_default_folder_viewer.
	
	* src/file-manager/nautilus-directory-view-ui.xml: Changed
	"Reset to View Preferences" to "Reset View to Match Preferences".
	It's really long, but the former was very unclear. Improvements
	to wording are hereby solicited.
	
	* src/nautilus-application.c: (manufactures), (create_object),
	(default_folder_viewer_changed_callback): Updated for #define
	name changes.
	(nautilus_application_startup): Moved code that reacted to
	default folder viewer preference to nautilus-global-preferences.c.

2001-04-23  John Harper  <jsh@eazel.com>

	* nautilus-clean.sh: added `nautilus-news' to list of auxiliary
	programs

2001-04-23  Darin Adler  <darin@eazel.com>

	* src/nautilus-window-manage-views.c: (open_location): Handle NULL
	case that can happen now that we check the workspace and area --
	the desktop is no longer guaranteed to be in the list considered
	when looking for the topmost window.

2001-04-23  John Harper  <jsh@eazel.com>

	* components/news/nautilus-news.c (set_up_edit_widgets): when
	packing the remove list into its container, use `TRUE, TRUE'
	instead of `FALSE, FALSE'. This makes the `Remove a site' list
	expand properly

2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* libnautilus-extensions/nautilus-preferences-box.c:
	(preferences_box_populate_pane):
	Make sure we use the translated strings for pane and group names.
	
2001-04-23  Darin Adler  <darin@eazel.com>

	Fix bug 7830 (Nautilus should launch programs with code that has
	xalf support [like the panel does]).

	* libnautilus-extensions/nautilus-program-choosing.c:
	(get_xalf_prefix): Implemented, but not tested with xalf.

2001-04-23  John Harper  <jsh@eazel.com>

	* components/news/nautilus-news.c (set_up_configure_widgets):
	don't set the shadow type of the viewport to no shadow. This
	causes a drawing bug to occur, where vestiges of the checkbox
	prelight aren't erased

2001-04-23  Darin Adler  <darin@eazel.com>

	Prep for xalf feature. Add name of program to all code that
	uses the launch_application_from_command function.

	* libnautilus-extensions/nautilus-program-chooser.c:
	(launch_mime_capplet): Pass the file name of the files and
	programs capplet when starting it up. (Is there a better name to
	use for this case?)
	* src/file-manager/fm-desktop-icon-view.c:
	(change_background_callback): Pass "Background" as the name when
	starting the Background capplet.
	* src/file-manager/fm-directory-view.c: (run_script_callback):
	Pass the file name of the script as the name when starting a
	script.
	(activate_callback): Pass the file name of an executable file when
	starting an executable file by opening it.
	
	* libnautilus-extensions/nautilus-program-choosing.h:
	* libnautilus-extensions/nautilus-program-choosing.c:
	(nautilus_launch_application): Pass the application name from the
	gnome-vfs MIME database when starting an application.
	(get_xalf_prefix): Placeholder for code to figure out the right
	set of parameters to pass to xalf.
	(nautilus_launch_application_from_command): Change to take a name
	for the application. It's ignored when xalf is not used, but used
	as the title when xalf is used.

2001-04-23  Darin Adler  <darin@eazel.com>

	Fix bug 8027 (Viewer preferences are not respected).
	
	* src/nautilus-window.c:
	(nautilus_window_handle_ui_event_callback): Check
	updating_bonobo_state and ignore any callbacks while it's true.

2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* test/test-nautilus-preferences-display.c: (main):
	Need to initialize preferences.
	
2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* components/news/Makefile.am:
	Make sure the nautilus-news-pixmaps.h header is exported to the
	dist tarball.
	
2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	Part of bug 7601 - FreeBSD portability fixes.

	* components/music/esd-audio.c: (esdout_loop): Add return NULL to
	make gcc happy.

	* components/music/mpg123.c: (decode_loop): Add return NULL to
	make gcc happy.

	* libnautilus-extensions/nautilus-customization-data.c: Add
	missing include of <stdlib.h>

	* libnautilus-extensions/nautilus-file.c: (group_includes_user):
	Cast the gid to (gid_t)

	* libnautilus-extensions/nautilus-sound.c: Include <wait.h> only
	if we have it.  Otherwise try <sys/wait.h>.

	* src/nautilus-bookmark-parsing.c: Add 	missing include of <stdlib.h>

2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* components/news/Makefile.am:
	Add include flags for for pixmaps in header file included from the
	source directory - which is different from the build directory for
	the tinderbox build.

	* components/news/nautilus-news.c:
	* components/news/nautilus-news-pixmaps.h:
	* components/news/pixmaps.h:
	Rename pixmaps.h to nautilus-news-pixmaps.h to prevent confusion
	in the future.

2001-04-22  Andy Hertzfeld  <andy@eazel.com>

	* components/Makefile.am:
	Josh pointed out that I forgot to add the news component here.
	
2001-04-22  Andy Hertzfeld  <andy@eazel.com>

	implemented change tracking and made the sidebar tab get an
	notification image whenever there's anything new.  Also, improved
	updating and other tweaks.  The news view is pretty much done
	now except for some images from Arlo and lots of testing/debugging.

	* components/news/nautilus-news.c: (get_bonobo_properties),
	(set_bonobo_properties), (nautilus_news_expose_event),
	(nautilus_news_set_prelight_index),
	(nautilus_news_set_news_changed), (clear_channel_changed_flags),
	(nautilus_news_clear_changed_flags), (update_size_and_redraw),
	(has_matching_uri), (mark_new_items), (rss_read_done_callback),
	(nautilus_news_load_channel), (news_get_indicator_image),
	(add_command_buttons), (make_news_view):
	
	* src/nautilus-sidebar.c: (notify_current_sidebar_view),
	(nautilus_sidebar_activate_panel),
	(nautilus_sidebar_deactivate_panel):
	added open/close notifications for sidebar views using
	the bonobo propery bag mechanism
	
2001-04-21  Andy Hertzfeld  <andy@eazel.com>

	implemented the remove command for the news panel, plus
	other clean-ups.
	
	* components/news/nautilus-news.c: (configure_button_clicked),
	(add_site_button_clicked), (add_channel_to_remove_list),
	(add_site_from_fields), (remove_selected_site),
	(add_command_buttons), (add_channel_entry),
	(add_channels_to_lists), (news_label_new),
	(select_row_in_remove_list), (make_remove_widgets),
	(make_add_widgets), (set_up_edit_widgets),
	(set_up_configure_widgets), (make_news_view):

2001-04-21  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (do_destroy), (draw_triangle),
	(draw_rss_logo_image), (is_current_uri), (draw_rss_items),
	(nautilus_news_motion_notify_event), (rss_read_done_callback),
	(make_news_view):

	various improvements to the news view, including Arlofied item positioning,
	prelighting of logos and disclosure triangle, and using bold text
	to indicate the current item instead of a different color.
	
2001-04-20  Gene Z. Ragan  <gzr@eazel.com>

	reviewed by: Darin Adler <darin@eazel.com>

	Fixed bug 8073, roll over Red Hat patches for their
	"plug-n-play" feature to Nautilus.
	
	The code does not use magicdev, but instead uses our
	distribution agnostic volume monitor to achieve identical,
	and in some cases superior, results.
	
	* libnautilus-extensions/nautilus-volume-monitor.c: (floppy_sort),
	(nautilus_volume_monitor_get_target_uri),
	(nautilus_volume_monitor_should_integrate_trash),
	(mount_volume_get_name), (mount_volume_activate),
	(mount_volume_deactivate), (mount_volume_floppy_add),
	(mount_volume_ext2_add), (mount_volume_udf_add),
	(mount_volume_vfat_add), (mount_volume_msdos_add),
	(mount_volume_iso9660_add), (mount_volume_affs_add),
	(mount_volume_auto_add), (mount_volume_cdda_add),
	(mount_volume_fat_add), (mount_volume_hpfs_add),
	(mount_volume_hsfs_add), (mount_volume_minix_add),
	(mount_volume_nfs_add), (mount_volume_proc_add),
	(mount_volume_reiserfs_add), (mount_volume_ufs_add),
	(mount_volume_smb_add), (mount_volume_unsdos_add),
	(mount_volume_xenix_add), (mount_volume_xiafs_add), (find_volumes),
	(create_volume), (copy_volume), (mount_volume_add_filesystem):
	Determine device type when performing volume type specific mount tasks.
	
	* libnautilus-extensions/nautilus-volume-monitor.h:
	Add new device type enumeration.
	
	* src/file-manager/fm-desktop-icon-view.c: (create_mount_link):
	
	* src/nautilus-application.c: (volume_mounted_callback):
	Check for cdroms being mounted and open a window to the cdrom
	mount point if the user has specified that behavior in the
	gnome preferences.

2001-04-20  Ramiro Estrugo  <ramiro@eazel.com>

	* src/nautilus-theme-selector.c:
	Trim down the includes a little bit to only those that are needed.
	
2001-04-20  Ramiro Estrugo  <ramiro@eazel.com>

	* README:
	Update the Mozilla information to point to Taska's support FAQ
	instead of the Nautilus mailing list post.
	
2001-04-20  Andy Hertzfeld  <andy@eazel.com>

	first check-in of "news" sidebar view to display news from selected
	sites that support an rss feed.  It's around 80% completed now, and
	should be quite usable; I just need to finish the remaining 80%.
	
	* components/news/.cvsignore:
	* components/news/Makefile.am:
	* components/news/Nautilus_View_news.oaf.in:
	
	* components/news/nautilus-news.c: (get_bonobo_properties),
	(set_bonobo_properties), (do_destroy), (pixbuf_composite),
	(draw_triangle), (draw_rss_logo_image), (draw_rss_title),
	(draw_rss_items), (nautilus_news_draw_channel),
	(nautilus_news_update_display), (nautilus_news_configure_event),
	(nautilus_news_expose_event), (nautilus_news_set_prelight_index),
	(go_to_uri), (toggle_open_state), (item_hit_test),
	(nautilus_news_button_release_event),
	(nautilus_news_motion_notify_event),
	(nautilus_news_leave_notify_event), (nautilus_news_set_title),
	(free_rss_data_item), (free_rss_channel_items), (free_channel),
	(nautilus_news_free_channel_list), (bool_to_text),
	(nautilus_news_make_channel_document),
	(nautilus_news_save_channel_state), (rss_logo_callback),
	(extract_items), (update_size_and_redraw),
	(rss_read_done_callback), (nautilus_news_load_channel),
	(nautilus_news_make_new_channel), (nautilus_news_add_channels),
	(get_xml_path), (read_channel_list), (check_for_updates),
	(news_get_indicator_image), (load_xpm_image),
	(nautilus_news_load_images), (configure_button_clicked),
	(add_site_button_clicked), (add_site_from_fields),
	(add_command_buttons), (get_channel_from_name),
	(check_button_toggled_callback), (nautilus_news_load_location),
	(add_channel_entry), (add_channels_to_configure_list),
	(set_up_add_widgets), (set_up_configure_widgets),
	(set_up_main_widgets), (make_news_view), (main):
	
	* components/news/news_bullet.png:
	* components/news/news_channels.xml:
	* components/news/pixmaps.h:
	* configure.in:

2001-04-20  Ramiro Estrugo  <ramiro@eazel.com>

	* ChangeLog: rolled over to ChangeLog-20010420.
