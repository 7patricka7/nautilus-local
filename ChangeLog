2001-02-02  Ramiro Estrugo  <ramiro@eazel.com>

	reviewed by: Maciej Stachowiak  <mjs@eazel.com>

	Fix bug 6131 - NautilusLabel does not support proper line wrap.
	Its fixed for smooth mode.  Theres a bug (6243) for the more
	complicated issue of wrapping in non smooth mode.

	* libnautilus-extensions/nautilus-label.h:
	* libnautilus-extensions/nautilus-label.c:
	(nautilus_label_initialize_class), (nautilus_label_set_arg),
	(nautilus_label_get_arg), (nautilus_label_size_allocate),
	(nautilus_label_set_never_smooth),
	(nautilus_label_set_adjust_wrap_on_resize),
	(nautilus_label_get_adjust_wrap_on_resize):
	Add a boolean attribute 'adjust_wrap_on_resize' that controls
	whether the label will automatically update its line wrap width
	when its resized.

	* components/services/summary/nautilus-view/nautilus-summary-view.c
	: (summary_view_item_label_new), (summary_load_location_callback):
	No longer need size_allocate hack.  Use NautilusLabel's
	'adjust_wrap_on_resize' attribute instead.
	
	* test/test-nautilus-label-wrapped.c: (create_nautilus_label),
	(create_gtk_label_window), (create_nautilus_label_window), (main):
	Update for 'adjust_wrap_on_resize'.
	
2001-02-01  Maciej Stachowiak  <mjs@eazel.com>

	reviewed by: Pavel Cisler  <pavel@eazel.com>

	Fix bug 4678 (Clicking on a Nautilus link file in tree view causes
	Nautilus cannot handle item type error box).
	
	* components/tree/nautilus-tree-view.c:
	(nautilus_tree_view_destroy), (got_activation_uri_callback),
	(cancel_possible_activation), (tree_select_row_callback): Activate
	activation URI instead of file URI to support Nautilus links
	properly. If the link resolves to a "command:" URI, however,
	silently ignore it to avoid giving an ugly error message because
	per John Sullivan, selecting things in the tree view should not
	launch apps.

	* components/tree/nautilus-tree-view-private.h: Added
	activation_uri_wait_file field to details struct.

	* data/top/Computer, data/top/Services: Updated to new nautilus
	link format.

2001-02-02  Robey Pointer  <robey@eazel.com>

	* components/services/install/nautilus-view/nautilus-service-instal
	l-view.c: (flatten_package_tree_foreach):

	Fix build breakage caused by my previous checkin.

2001-02-02  Robey Pointer  <robey@eazel.com>

	reviewed by: Eskil Heyn Olsen  <eskil@eazel.com>

	* components/services/install/lib/eazel-install-logic2.c:
	(is_satisfied), (download_packages):
	* components/services/install/lib/eazel-install-protocols.c:
	(gnome_vfs_fetch_remote_file):

	Fix thinko (caused by myself in October) that caused the stop
	button to only cancel one download and then aggravatingly continue
	with the remaining downloads.

	* components/services/install/idl/trilobite-eazel-install.idl:
	* components/services/install/lib/eazel-install-corba-callback.c:
	(impl_download_progress), (impl_preflight_check),
	(impl_download_failed), (impl_dep_check), (impl_install_progress),
	(impl_uninstall_progress), (impl_md5_check_failed),
	(impl_install_failed), (impl_uninstall_failed),
	(eazel_install_callback_simple_query):
	* components/services/install/lib/eazel-install-corba-types.c:
	(corba_string_sequence_to_glist),
	(g_list_to_corba_string_sequence),
	(corba_packagedatastruct_fill_from_packagedata),
	(corba_packagedatastruct_from_packagedata),
	(corba_packagedatastructlist_fill_from_packagedata_list),
	(corba_packagedatastructlist_from_packagedata_list),
	(new_fake_md5), (traverse_packagetree_md5),
	(corba_packagedatastruct_fill_deps),
	(corba_packagedatastructlist_foreach),
	(corba_packagedatastructlist_from_packagedata_tree),
	(packagedata_from_corba_packagedatastruct),
	(packagedata_list_from_corba_packagedatastructlist),
	(packagedata_tree_from_corba_packagedatastructlist),
	(corba_category_list_from_categorydata_list),
	(categorydata_list_from_corba_categorystructlist):
	* components/services/install/lib/eazel-install-corba-types.h:
	* components/services/install/lib/eazel-install-corba.c:
	(impl_Eazel_Install_install_packages),
	(impl_Eazel_Install_uninstall_packages),
	(impl_Eazel_Install_simple_query):
	* components/services/install/lib/eazel-install-object.c:
	(eazel_install_emit_preflight_check_default),
	(eazel_install_emit_install_failed_default),
	(eazel_install_emit_uninstall_failed_default):
	* components/services/install/lib/eazel-install-xml-package-list.c:
	(parse_package), (eazel_install_packagedata_to_xml_int),
	(eazel_install_packagedata_to_xml),
	(eazel_install_packagelist_to_xml):
	* components/services/install/lib/eazel-install-xml-package-list.h:

	Add proper "breaks", "modifies", and "depends" structures to the
	corba interface, by using package MD5 strings to serve as "soft
	pointers" between packages in a package tree.  Convert the
	preflight, install_failed, and uninstall_failed signals to use the
	new package-tree type instead of munging into and out of XML.
	Also fixed up the API's to the corba conversion routines so they
	would make a valiant attempt not to leak memory.

	* components/services/install/lib/eazel-package-system-types.c:
	(packagedata_copy):

	Don't forget to copy that pesky MD5!
	
	* components/services/install/lib/eazel-package-system-types.h:

	Satisfy Robey's desire to avoid Carpal Tunnel Syndrome.
	
	* components/services/install/lib/eazel-softcat.c:
	(eazel_softcat_string_to_sense_flags),
	(get_search_url_for_package):
	* components/services/install/lib/eazel-softcat.h:

	Add function to convert a sense string back into flags.
	
	* components/services/install/nautilus-view/nautilus-service-instal
	l-view.c: (flatten_package_tree_depends_foreach),
	(flatten_package_tree_foreach):

	Fix up the install view to use the new "depends" chain instead of
	the old "soft_depends" which is now empty.

2001-02-02  Ramiro Estrugo  <ramiro@eazel.com>

	* libnautilus-extensions/nautilus-metafile-factory.c: (corba_open):
	Add new line at end of file to make redhat7 build happy. 
	
2001-02-01  Ramiro Estrugo  <ramiro@eazel.com>

	reviewed by: Maciej Stachowiak  <mjs@eazel.com>

	* libnautilus-extensions/nautilus-global-preferences.c:
	(global_preferences_install_defaults),
	(global_preferences_install_visibility),
	(global_preferences_install_sidebar_panel_defaults):
	* libnautilus-extensions/nautilus-preferences.c:
	(nautilus_preferences_get_user_level):
	* libnautilus-extensions/nautilus-preferences.h:
	* src/nautilus-first-time-druid.c: (set_up_user_level_page):
	* src/nautilus-window-menus.c: (get_user_level_icon_name),
	(nautilus_window_initialize_menus), (convert_verb_to_user_level),
	(convert_user_level_to_path):
	* test/test-nautilus-preferences-change.c: (main):
	Change 'hacker' to 'advanced' for the advanced user level so that
	the names used for storage match those used for display.

2001-02-01  Maciej Stachowiak  <mjs@eazel.com>

	reviewed by: Darin Adler  <darin@eazel.com> and 
	             Robey Pointer  <robey@eazel.com>

	Fix bugs 5528 (oaf command-line options show up in main program
	section, not a separate section) and 5510 (descriptions of
	OAF-specific options in --help are not translated). To do this I
	had to change the way the oaf popt options are processed in all
	the places that do so.

	* components/adapter/main.c: (main):
	* components/hardware/main.c: (main):
	* components/help/hyperbola-main.c: (main):
	* components/image-viewer/Nautilus_View_image.oaf.in:
	* components/image-viewer/nautilus-image-view.c:
	(init_server_factory):
	* components/loser/content/main.c: (main):
	* components/loser/sidebar/main.c: (main):
	* components/mozilla/main.c: (main):
	* components/music/main.c: (main):
	* components/notes/nautilus-notes.c: (main):
	* components/rpmview/main.c: (main):
	* components/services/install/command-line/eazel-alt-install-corba.
	c: (main):
	* components/services/install/nautilus-view/main.c: (main):
	* components/services/login/nautilus-view/main.c: (main):
	* components/services/summary/nautilus-view/main.c: (main):
	* components/services/time/command-line/main.c: (main):
	* components/services/time/nautilus-view/main.c: (main):
	* components/services/trilobite/libtrilobite/trilobite-core-utils.c
	: (trilobite_init):
	* components/shell/shell.c:
	* components/text/Nautilus_View_text.oaf.in:
	* components/text/main.c: (main):
	* components/throbber/main.c: (main):
	* components/tree/main.c: (main):
	* libnautilus/nautilus-view-standard-main.c:
	(nautilus_view_standard_main_multi):
	* src/Nautilus_shell.oaf.in:
	* src/nautilus-main.c: (main):
	* test/test-nautilus-mime-actions-set.c: (main):
	* test/test-nautilus-mime-actions.c: (main): Register oaf options
	with gnomelib_register_popt_options and move oaf_init call to
	before gnome_init to fix the aforementioned bugs.

2001-02-01  Rebecca Schulman  <rebecka@eazel.com>
	Fixed bug 5648, bad ui in the indexing info
	dialog.

	reviewed by: Maciej Stachowiak <mjs@eazel.com>

	* src/file-manager/nautilus-indexing-info.c:
	(get_index_percentage_complete), (initialize_dialog),
	(get_text_for_progress_label), (update_progress_display),
	(show_index_progress_dialog), (show_reindex_request_dialog),
	(recreate_and_show_reindex_request_dialog),
	(update_file_index_callback),
	(last_index_time_and_reindex_button_dialog_new),
	(index_progress_dialog_new),
	(destroy_indexing_info_dialogs_on_exit),
	(show_indexing_info_dialog): Rework this file.  Use two separate
	index dialogs for the case where the index is going, and not
	going.  When "update now" is pressed, switch to the index progress
	dialog.  Report errors reported by and unavailibility of the
	indexing service.

	* libnautilus-extensions/nautilus-stock-dialogs.c:
	(nautilus_create_info_dialog):
	* libnautilus-extensions/nautilus-stock-dialogs.h:
	Add this for use in creating the indexing info dialog.
	

2001-02-01  Michael K. Fleming  <mfleming@eazel.com>

	reviewed by: <robey@eazel.com>

	Bug 6103 a user can install any package from softcat without login 
	Bug 4514 error msg when register during softcat install 

	Login dialog for the install view, with working registration, cancel,
	etc.


	* components/services/install/nautilus-view/Makefile.am:
	* components/services/install/nautilus-view/main.c: (main):
	* components/services/install/nautilus-view/nautilus-service-instal
	l-view.c: (nautilus_service_install_view_destroy),
	(nautilus_install_parse_uri), (nautilus_service_install_done),
	(user_login_callback),
	(nautilus_service_install_view_update_from_uri),
	(nautilus_service_install_view_update_from_uri_finish),
	(nautilus_service_install_view_load_uri):
	* components/services/summary/nautilus-view/nautilus-summary-menu-i
	tems.c: (merge_bonobo_menu_items):
	* components/services/summary/nautilus-view/nautilus-summary-view.c
	: (update_header), (nautilus_summary_view_load_uri):
	* src/nautilus-window-service-ui.c: (goto_online_storage),
	(goto_software_catalog):

2001-02-01  Michael Engber  <engber@eazel.com>

	* libnautilus-extensions/Makefile.am:
	* libnautilus-extensions/nautilus-metafile-factory.c:
	(nautilus_metafile_factory_initialize_class),
	(nautilus_metafile_factory_get_epv),
	(nautilus_metafile_factory_get_vepv),
	(nautilus_metafile_factory_create_servant),
	(nautilus_metafile_factory_initialize), (destroy),
	(nautilus_meta_file_factory_new), (corba_open):
	* libnautilus-extensions/nautilus-metafile-factory.h:
	* libnautilus-extensions/nautilus-metafile-server.idl:
	* libnautilus-extensions/nautilus-metafile.c:
	(nautilus_metafile_initialize_class), (nautilus_metafile_get_epv),
	(nautilus_metafile_get_vepv), (nautilus_metafile_create_servant),
	(nautilus_metafile_initialize), (destroy), (nautilus_metafile_new),
	(corba_get), (corba_get_list), (corba_set), (corba_set_list),
	(corba_copy), (corba_remove), (corba_rename),
	(corba_register_monitor), (corba_unregister_monitor):
	* libnautilus-extensions/nautilus-metafile.h:
	Initiall check-in of new metadata APIs (corba) - not hooked
	up yet.

2001-02-01  Gene Z. Ragan  <gzr@eazel.com>

	reviewed by: Pavel Cisler <pavel@eazel.com>
	
	Fixed bug 6941, 'Clean Up By Name' feature on the desktop keep switching
	file locations after being 'cleaned up'
	
	* src/file-manager/fm-desktop-icon-view.c:
	(desktop_icons_compare_callback):
	In the case of identical links tpyes, compare by name.	
		
	More work on gmc transtion tool
	
	* src/nautilus-first-time-druid.c:
	(druid_finished):
	Hide druid widget before performing startup tasks.
	
	(next_proxy_configuration_page_callback),
	(add_nautilus_to_session):

2001-02-01  Pavel Cisler  <pavel@eazel.com>

	reviewed by: Gene Ragan <gzr@eazel.com>

	Fix 6152 (Dragging a file to the trash will bring up a replace
		  dialog)
	Fix 5387 (Dragging a file within Trash gives "already exists"
		 error)

	* libnautilus-extensions/nautilus-drag.c:
	* libnautilus-extensions/nautilus-drag.h:
	(nautilus_drag_items_local), (nautilus_drag_items_in_trash):
	Add more convenience calls for Trash handling.
	
	* libnautilus-extensions/nautilus-file-utilities.h:
	* libnautilus-extensions/nautilus-file-utilities.c:
	(nautilus_uri_is_in_trash):
	New convenience call for Trash handling.

	* libnautilus-extensions/nautilus-file.c:
	(nautilus_file_is_in_trash):
	Use the new nautilus_uri_is_in_trash call.

	* libnautilus-extensions/nautilus-file-operations.c:
	(nautilus_file_operations_copy_move):
	Handle the case where a file is dragged into a Trash window or
	onto a Trash icon as if the "Move to Trash" command was issued -
	if there is a name conflict with a pre-existing file in the Trash,
	use a new unique name for the new file.
	
	* libnautilus-extensions/nautilus-icon-dnd.c:
	(nautilus_icon_container_selection_items_local):
	Handle files in the Trash properly - doing a parent match with
	the container URI fails for these, special case Trash handling.

2001-02-01  John Sullivan  <sullivan@eazel.com>

	reviewed by: Pavel Cisler <pavel@eazel.com>

	Fixed bug 143 (zooming in list view doesn't affect font size)

	Maybe I get the award for "oldest reported bug fixed recently"?

	* src/file-manager/fm-list-view.c: 
	(fm_list_view_update_font): New function, started with guts of
	fm_list_view_font_family_changed but also takes zoom level into
	account when choosing font size.
	(set_up_list): Call _update_font instead of _font_family_changed,
	just 'cuz it makes more sense.
	(fm_list_view_set_zoom_level): Call _update_font.
	(fm_list_view_font_family_changed): Extracted guts to
	_update_font.

2001-02-01  John Sullivan  <sullivan@eazel.com>

	reviewed by: Darin Adler <darin@eazel.com>

	Fixed bug 6181 (funny mouse clicking freezes Nautilus)

	* libnautilus-extensions/nautilus-icon-container.c:
	(button_press_event): Ignore middle & right button
	presses when we're dragging a selection rectangle.

2001-02-01  John Sullivan  <sullivan@eazel.com>

	reviewed by: Darin Adler <darin@eazel.com>

	* libnautilus-extensions/nautilus-global-preferences.c:
	(global_preferences_install_descriptions):
	Parenthesize parenthetical part of "slow but complete
	search" checkbox label.
	(global_preferences_create_dialog): Use SHORT_ENUM
	instead of ENUM type for executable text file
	activation options so they all go on one line, taking
	less precious vertical screen real estate.

2001-02-01  Darin Adler  <darin@eazel.com>

	* components/services/install/lib/eazel-package-system-types.h:
	Add missing packagedata_destroy prototype to make it compile
	on systems with RPM 4 (like mine).

2001-02-01  Maciej Stachowiak  <mjs@eazel.com>

	* ChangeLog: rolled over to ChangeLog-20010201.

