2001-04-27  Andy Hertzfeld  andy@eazel.com>

	added preferences for the maximum numder of items per site and
	the update interval.  It's not quite finished, as the news
	view isn't watching the update interval preference yet.
	
	* components/news/nautilus-news.c: (do_destroy), (draw_rss_items),
	(nautilus_news_make_new_channel), (max_items_changed),
	(make_news_view):
	use the preference for max items and update interval
	
	* libnautilus-extensions/nautilus-global-preferences.c:
	define defaults for news panel preferences
	
	* libnautilus-extensions/nautilus-global-preferences.h:
	define news panel preferences
	
	* src/nautilus-preferences-dialog.c:
	add a news panel pane to the preferences dialog
	
2001-04-26  Andy Hertzfeld  <andy@eazel.com>

	changed the news panel not to display any sites by default, since
	it's obnoxious to be doing periodic I/O to sites that weren't explicitly
	enabled.  Added an instructive message about the news panel that is
	displayed when no sites are enabled.
	
	Also, made it immediately test new rss urls when they are input, and
	display an error dialog instead of adding them if they fail.
	
	Also, make it always display the main news display (not configuration
	stuff) when the panel is opened, even if it was in configure mode
	when closed. Plus a few smaller tweaks.
	
	* components/news/nautilus-news.c: (set_bonobo_properties),
	(toggle_open_state), (count_visible_channels),
	(set_views_for_mode), (configure_button_clicked),
	(add_site_from_fields), (make_add_widgets), (set_up_main_widgets),
	(make_news_view):
	
	* components/news/news_channels.xml:
	turn off all the channels by default
	
2001-04-26  Ramiro Estrugo  <ramiro@eazel.com>

	* configure.in: Make the control-center (capplet module) check
	properly decode the version number.  Awk wasn't being fed the
	right delimeter.
	
2001-04-26  Dan Mueth  <dan@eazel.com>

	Bringing three more images over from the 1.0.1/1.0.2 branch.
	The dimensional size of these are smaller, although they
	are not all smaller in bytes.  I think this difference
	is why John didn't originally bring these over from the branch.

	* help/nautilus-quick-reference/C/figures/find.png:
	* help/nautilus-quick-reference/C/figures/full.png:
	* help/nautilus-quick-reference/C/figures/music.png:

2001-04-26  Darin Adler  <darin@eazel.com>

	* THANKS: Give Alex Larsson credit for his contribution.

	* configure.in: Added the screenshot directory. Updated the check
	for control center to check for libcapplet instead. Chris Lahey
	told me that Ximian did this in the version they released, so I
	figured I should do it here too.

	* help/nautilus-screenshot-guidelines/.cvsignore:
	* help/nautilus-screenshot-guidelines/C/.cvsignore:
	Ignore more generated files.

2001-04-26  Darin Adler  <darin@eazel.com>

	Integrated a patch by Alexander Larsson <alla@lysator.liu.se> that
	adds a JPEG-specific thumbnailing function that's faster than the
	exiting thumbnail code. This new code is only included if the
	libjpeg library is present at configure time. We still need RPM
	spec file changes to require this library if we are going to build
	RPMs on systems that have libjpeg. I fixed a few bugs in Alex's
	original patch and made some coding style tweaks as well.

	* acconfig.h:
	* configure.in:
	Added a check for libjpeg.
	
	* libnautilus-extensions/Makefile.am:
	* libnautilus-extensions/nautilus-thumbnails-jpeg.c:
	* libnautilus-extensions/nautilus-thumbnails-jpeg.h:
	Add new source files with JPEG thumbnailer.
	
	* libnautilus-extensions/nautilus-thumbnails.c: (make_thumbnails):
	Call the new function for JPEG files.

	Other changes.
	
	* libnautilus-extensions/nautilus-volume-monitor.c: Change
	interval back to 2 seconds.

	* libnautilus-extensions/nautilus-preferences.c:
	(preferences_set_storage_path): Fix storage leak.
	(nautilus_self_check_preferences): Added more checks.
	
	* libnautilus-extensions/nautilus-icon-factory.c:
	(nautilus_icon_factory_get_icon_for_file): Tiny code tweak.

2001-04-26  Rebecca Schulman  <rebecka@eazel.com>
	
	Fix bugzilla.eazel.com bug 7934, to remove the ability
	to make an index using Nautilus.  

	reviewed by: Darin Adler <darin@eazel.com>

	* src/file-manager/fm-list-view.c: (get_cell_text):
	* src/file-manager/fm-search-list-view.c: (real_load_error),
	(display_indexed_search_problems_dialog), (real_get_link_column),
	(real_get_emblems_column):
	Simplify the dialog that allows a Nautilus user to request a new 
	index.  Tell the user instead how to create an index if the user
	has root access in this dialog instead.
	* src/file-manager/nautilus-indexing-info.c:
	(show_last_index_time_dialog), (last_index_time_dialog_new),
	(index_progress_dialog_new), (show_indexing_info_dialog):
	* src/file-manager/nautilus-indexing-info.h:
	Remove the request reindex function.  Remove option to create a new
	index.  Keep dialogs to show either the time of the last index creation,
	or the progress of the current indexing task, depending on whether
	an index is in progress or not.

2001-04-26  Dan Mueth  <dan@eazel.com>

	Committing first draft of the screenshot guidelines for Nautilus
	documentation.  It isn't completely done, but it will be safer in
	CVS than on my hard drive.

	* help/Makefile.am:
	* help/nautilus-screenshot-guidelines/C/Makefile.am:
	* help/nautilus-screenshot-guidelines/C/figures/callout_after.png:
	* help/nautilus-screenshot-guidelines/C/figures/callout_before.png:
	* help/nautilus-screenshot-guidelines/C/figures/circle_callout_afte
	r.png:
	* help/nautilus-screenshot-guidelines/C/figures/circle_callout_befo
	re.png:
	* help/nautilus-screenshot-guidelines/C/figures/dropshadow_after.pn
	g:
	* help/nautilus-screenshot-guidelines/C/figures/dropshadow_before.p
	ng:
	* help/nautilus-screenshot-guidelines/C/nautilus-screenshot-guideli
	nes-C.omf:
	* help/nautilus-screenshot-guidelines/C/nautilus-screenshot-guideli
	nes.sgml:
	* help/nautilus-screenshot-guidelines/Makefile.am:

2001-04-26  Darin Adler  <darin@eazel.com>

	Integrated Miguel's patches that he included in Ximian's version
	of Nautilus 1.0 after fixing some bugs, fixing all warnings, and
	adding code to not do the reload of the desktop every 4 seconds if
	FAM is working. The patch does a lot of things, mostly so that
	people can switch back and forth between gmc and nautilus more
	easily.
	
	* components/news/nautilus-news.c: Tweaked includes.
	* src/nautilus-view-frame.c: Tweaked a comment.

Here are notes Miguel included in the patch about the changes he made:

- 2001-04-19  Miguel de Icaza  <miguel@ximian.com>

	* libnautilus-extensions/nautilus-file.c (nautilus_file_get_name):
	Only return name when we actually loaded the name from the desktop
	entry.

	* libnautilus-extensions/nautilus-icon-factory.c
	(nautilus_icon_factory_get_icon_for_file): Compute file_path from
	file_uri, it was missing in this code path.

- 2001-04-16  Miguel de Icaza  <miguel@ximian.com>

	* libnautilus-extensions/nautilus-file.c
	(is_special_desktop_gmc_file): Use strcmp not strncmp here. 

	* src/nautilus-window.c (nautilus_window_realize): Use gnome-logo
	here. 

	* src/file-manager/fm-directory-view.c (activate_callback): Launch
	desktop entries here. 

- 2001-04-11  Miguel de Icaza  <miguel@ximian.com>

	* src/file-manager/fm-icon-view.c
	(get_stored_icon_position_callback): Try to load position
	information from GNOME metadata as well.
	(icon_position_changed_callback): Store metadata changes to the
	desktop as well.

	* src/nautilus-first-time-druid.c
	(nautilus_first_time_druid_show): Disable GMC transition page, as
	we now share the desktop directory and the data files.
	(druid_finished): Remove desktop link to Eazel services.

	* libnautilus-extensions/nautilus-file.c
	(nautilus_file_can_rename): Do not allow to rename x-gnome-apps. 
	(nautilus_file_get_name): Return the translated name of a desktop
	file instead of the file name.  
	Handle URL files in .gnome-desktop directories. 
	(is_special_desktop_gmc_file): New function: Returns true if a
	file should be hidden from the desktop-directory display (for
	sharing the directory with gmc).
	(filter_hidden_and_backup_partition_callback): If we are scanning
	the desktop directory, hide gmc metadata files or legacy files.

	* libnautilus-extensions/nautilus-directory-async.c
	(activation_uri_gmc_link_read_callback): Handle GMC link files
	correctly (skip the prefix "URL: ")

	* libnautilus-extensions/nautilus-icon-factory.c
	(nautilus_icon_factory_get_icon_for_file): Load icons from the
	gnome-metadata for files on the ~/.gnome-desktop directory.
	(nautilus_icon_factory_get_icon_for_file): Load icons for GNOME
	.desktop files.

- 2001-04-11  Miguel de Icaza  <miguel@ximian.com>

	* libnautilus-extensions/nautilus-directory-async.c
	(activation_uri_gmc_link_read_callback): Handle gmc URL
	links correctly.

- 2001-04-10  Miguel de Icaza  <miguel@ximian.com>

	* libnautilus-extensions/nautilus-file-utilities.c
	(DESKTOP_DIRECTORY_NAME): Make it .gnome-desktop.
	(nautilus_get_desktop_directory): Modified to make the nautilus
	home directory be the normal one.

- 2001-04-09  Miguel de Icaza  <miguel@ximian.com>

	* src/file-manager/fm-desktop-icon-view.c: Eliminated all over the
	place the loading of the desktop_directory directory from the
	nautilus api call, and instead just load this value once.

Here are changes that Miguel made, but did not mention in his notes:
	
	* libnautilus-extensions/nautilus-volume-monitor.c: Changed
	the interval for polling to every 4 seconds instead of every 2.

	* libnautilus-extensions/nautilus-file.c: (nautilus_file_rename):
	Rename GMC URLs by changing their metadata only. This leaves no
	way to change the real name of the GMC URL file.
	(nautilus_file_is_in_desktop): New function. Returns TRUE if a
	file seems to be in the desktop. Uses a simple rule that might
	give some false positives, but works even for other people's
	desktop.
	
	* src/file-manager/fm-desktop-icon-view.c:
	(fm_desktop_icon_view_destroy), (do_desktop_rescan),
	(done_loading), (delayed_init), (fm_desktop_icon_view_initialize):
	Set up a callback to reload the desktop every 4 seconds.
	
	* src/nautilus-application.c: (migrate_gmc_trash),
	(migrate_old_nautilus_files), (nautilus_application_startup):
	Rename ~/.gnome-desktop/Trash to ~/.gnome-desktop/Trash-gmc if
	it's a directory. Move files from ~/.nautilus/desktop to
	~/.gnome-desktop.
	
2001-04-26  Dan Mueth  <dan@eazel.com>

	Updated Nautilus Release Notes for Nautilus 1.0.3.  It
	still will need some work and additions, but I have most
	of the boilerplate stuff and new features added.

	* help/nautilus-release-notes/C/nautilus-release-notes.sgml:

2001-04-26  Ramiro Estrugo  <ramiro@eazel.com>

	* libnautilus-extensions/nautilus-preferences-group.c:
	* libnautilus-extensions/nautilus-preferences-group.h:
	Add support for custom preferences items.

	* libnautilus-extensions/nautilus-preferences-item.h:
	* libnautilus-extensions/nautilus-preferences-item.c:
	Add support for custom preferences items.  For now only the theme
	selector uses this powerful technology.

	Fix bug 8167 - Crash boinking on single-click mode.  It was a dumb
	mistake left over from a previous fix.  Wrong number of arguments
	to a signal.

	Fix bug where strings in enumeration menus would show up
	untranslated in the preferences dialog, even in locales where
	translations exist.
	
	* libnautilus-extensions/nautilus-theme.h:
	* libnautilus-extensions/nautilus-theme.c: (load_theme_document),
	(nautilus_pixmap_file_may_be_local),
	(nautilus_theme_get_image_path_from_theme),
	(nautilus_theme_make_preview_pixbuf): Rename this function from
	nautilus_theme_make_selector for greater clarity.
	(has_image_file), (theme_get_property), (theme_get_name_property),
	(theme_get_description_property), (theme_list_insert),
	(theme_get_themes_for_location): Replace some cut-n-paste code by
	a shared function.  Add some FIXMEs for the funky handling of the
	"default" theme.
	(theme_get_builtin_themes), (theme_get_user_themes),
	(theme_get_default_themes): Functions for reaping the
	different types of themes available to Nautilus.
	(nautilus_theme_for_each_theme), (theme_list_invoke_callback): New
	function to iterate all the themese available to Nautilus.  Makes
	Nautilus code that needs to operate on themes (like the theme
	selector) easier to write.
	(nautilus_theme_get_user_themes_directory),
	(nautilus_theme_remove_user_theme),
	(nautilus_theme_install_user_theme):  Functions for reaping the
	different types of themes available to Nautilus.
	
	* src/nautilus-preferences-dialog.c:
	(preferences_dialog_populate_sidebar_tabs_group),
	(theme_changed_callback),
	(update_theme_selector_displayed_value_callback),
	(preferences_dialog_populate_themes_group):
	Add a custom preference item for the theme chooser.
	
	* src/nautilus-theme-selector.h:
	* src/nautilus-theme-selector.c:
	Use regular Gtk widgets in the list so that all the things that
	are expect to work do indeed work.  This includes Gtk+ theme
	changes and custom tweaks made in the code to satisfy the design.
	Larger and bolder labels for example.

	Simplify this code alot by using iterators for the available
	themes.  Also maintain two lists instead of managing a remove_mode
	boolean.  Makes the code simpler.
	
	* src/nautilus-window-menus.c:
	(nautilus_window_initialize_menus_part_1):
	Remove the standalone theme selector handling code.
	
	* src/nautilus-shell-ui.xml:
	Remove the standalone theme selector ui.

2001-04-26  John Sullivan  <sullivan@eazel.com>

	Made the emblems column wider to fit the title "Emblems" (in
	English, in the default font). Made the emblems column in the
	search results view match the one in the standard list view.

	Pavel wants to implement images as column titles, but this is
	passable if that doesn't get done.

	* src/file-manager/fm-list-view.c: (real_get_column_specification):
	Widen the emblems column.
	
	* src/file-manager/fm-search-list-view.c:
	(real_get_emblems_column), 
	(real_get_link_column): Swap positions of name/emblems columns.
	(real_get_column_specification): Widen the emblems column.

2001-04-26  John Sullivan  <sullivan@eazel.com>

	Search results view has been broken for awhile without anyone
	noticing. Between these changes and a NULL-handling fix I
	checked into eel-list.c, it works again. (Soon I will move the
	Emblems column for search list view also, but first I wanted
	to make it work.)

	* src/file-manager/fm-list-view.h:
	* src/file-manager/fm-list-view.c: (fm_list_view_initialize_class),
	(add_to_list), (install_row_images), (get_emblems_column),
	(real_get_emblems_column): Replaced #define for emblems column
	with overridable function.
	
	* src/file-manager/fm-search-list-view.c:
	(fm_search_list_view_initialize_class),
	(real_get_emblem_names_to_exclude), (real_get_emblems_column):
	Override get_emblems_column to return correct value.

2001-04-26  John Sullivan  <sullivan@eazel.com>

	Moved over a few changes from the nautilus-1 branch. 
	I've reviewed all the changes in the branch ChangeLog now,
	so I think we can kiss it goodbye.
	
	* configure.in: Bumped a bunch of version numbers to match
	branch. Robin may have to do some more bumping before 
	shipping 1.0.3.

	* help/nautilus-user-manual/C/figures/custicon.png:
	* help/nautilus-user-manual/C/figures/full.png:
	* help/nautilus-user-manual/C/figures/part.png:
	Smaller versions of screenshots which were too big to
	fit in the Nautilus main panel, by Arlo. (For some reason
	nautilus-quick-reference on HEAD had smaller figures than
	on nautilus-1, but vice-versa for nautilus-user-manual.)

	* src/nautilus-preferences-dialog.c:
	* src/nautilus-shell-ui.xml:
	* src/nautilus-window-menus.c:
	(nautilus_window_initialize_menus_part_1): Made Medusa stuff not
	appear when HAVE_MEDUSA is not defined.

	Other changes:
	
	* libnautilus-extensions/nautilus-program-choosing.c:
	(get_xalf_prefix): Bug fix from Darin (!= -> ==) that
	was breaking launching applications unless you had xalf
	installed (not from branch)
	

2001-04-26  Dan Mueth  <dan@eazel.com>

	Cleaning up documentation build system.  Now there should
	be no or few warnings spit out about the docs.

	* help/Makefile.am:
	* help/docs.make:
	* help/htmldocs.make:
	* help/nautilus-quick-reference/es/Makefile.am:
	* help/nautilus-quick-reference/no/Makefile.am:
	* help/nautilus-release-notes/C/Makefile.am:
	* help/nautilus-user-manual/C/Makefile.am:
	* help/nautilus-user-manual/es/Makefile.am:
	* help/nautilus-user-manual/ko/Makefile.am:
	* help/sgmldocs.make:

2001-04-25  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (nautilus_news_update_display):
	reversed decision about not drawing while the channel was loading
	since it's important to give feedback right away when a channel is
	enabled, and they sometimes takes a long time to load.
	
	* libnautilus-extensions/nautilus-global-preferences.c:
	* libnautilus-extensions/nautilus-sidebar-functions.c:
	* libnautilus-extensions/nautilus-sidebar-functions.h:
	enabled the news panel by default.  Also, while I was in here, I
	made the "home as desktop" feature only available at the advanced
	user level like Bud suggested.
	
2001-04-25  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (draw_rss_items),
	(nautilus_news_draw_channel), (nautilus_news_size_allocate):
	fixed measuring bug caused by the size of the scroll bar
	affecting the layout.  Fixed by calculating the line width at
	size_allocate time, instead of on the spur of the moment.
	
2001-04-25  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (draw_rss_logo_image),
	(draw_rss_items), (nautilus_news_configure_event),
	(nautilus_news_button_release_event), (update_size_and_redraw),
	(nautilus_news_size_allocate), (make_news_view):
	
	attach to size_allocate signal to properly resize the panel
	when the width changes, as well as for the first time when the
	size isn't allocated yet; don't draw the time when it overlaps
	the logo, plus other clean-ups.
	
	* nautilus-clean.sh:
	fixed recently introduced problem in nautilus-clean by replacing
	'==' with '=' as suggested by Darin.
	
2001-04-25  Robin * Slomkowski  <rslomkow@eazel.com>

	* nautilus.spec.in: removed mozilla-mail and mozilla-psm dependency
	                    http://bugzilla.eazel.com/show_bug.cgi?id=8020

2001-04-25  Dan Mueth  <dan@eazel.com>

	Adding versions from 1_0_1_BRANCH, which are more up-to-date.

	* help/nautilus-release-notes/C/nautilus-release-notes.sgml:
	* help/nautilus-user-manual/C/nautilus-user-manual.sgml:

	Adding version for 1.0.1 and 1.0.2.

	* help/nautilus-quick-reference/C/index.html:

2001-04-25  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c:
	(nautilus_news_button_release_event)
	fixed bug 8153, scroll wheel crashes news panel, by only
	taking action when button 1 is clicked.
		
	(add_site_from_fields):
	added error handling for when the fields are empty; also, use
	http as the protocol if no protocol is specified.
	
2001-04-25  Darin Adler  <darin@eazel.com>

	* src/nautilus-window-menus.c: (help_menu_about_nautilus_callback):
	Made the Copyright string translatable again, by popular demand.

2001-04-24  Dan Mueth  <dan@eazel.com>

	Left-justifying the labels in the help sidebar.
	Also changed strings to remove colons ":".
	Bug#: 8123

	* components/help/hyperbola-nav-tree.c:
	(hyperbola_navigation_tree_new):

	Updating so that 'make install' works right
	and users building RPM's don't get lots of warnings.
	Bug#: 8125

	* omf-install/Makefile.am:

	Changing from "Customer Support" to "Community Support".
	Bug#: 7837

	* src/nautilus-shell-ui.xml:

2001-04-24  Darin Adler  <darin@eazel.com>

	Fix bug 8152 (Opening Help sidebar crashes Nautilus):
	
	* src/nautilus-sidebar.c: (notify_current_sidebar_view): Add check
	for NIL control.

	* nautilus-clean.sh: Change egrep args so we get fewer false
	positives.
	
	* src/nautilus-view-frame.c: (nautilus_view_frame_get_control):
	Formatting tweaks.

2001-04-24  Darin Adler  <darin@eazel.com>

	reviewed by: Maciej Stachowiak <mjs@eazel.com>

	Fix bug 7963 (exiting Nautilus [with Ctrl-C for example] leaves
	nautilus-adapter behind):

	* src/nautilus-component-adapter-factory.c: (activate_factory),
	(unref_factory), (release_factory), (get_corba_factory),
	(nautilus_component_adapter_factory_initialize),
	(nautilus_component_adapter_factory_destroy),
	(nautilus_component_adapter_factory_initialize_class),
	(component_adapter_factory_at_exit_destructor),
	(nautilus_component_adapter_factory_get),
	(nautilus_component_adapter_factory_create_adapter): Redo so it
	creates the factory as needed, and doesn't keep a Bonobo reference
	to the factory so it will die if Nautilus goes away.

	* nautilus-clean.sh: Redo option parsing to use loop.

	* components/throbber/main.c: (main): Fix main function to match
	standard main. Tweak formatting.
	
2001-04-24  John Sullivan  <sullivan@eazel.com>

	Fixed bug 8418 (two more underline-accelerator conflicts)

	* src/file-manager/nautilus-directory-view-ui.xml: Changed
	"Make _Link" to "_Make Link" to avoid conflict with sometimes-
	present "De_lete"
	
	* src/file-manager/nautilus-icon-view-ui.xml: Changed
	"_Tighter Layout" to "Tighter _Layout" to avoid conflict
	with "By _Type".

2001-04-24  John Sullivan  <sullivan@eazel.com>

	Fixed part of bug 7649 (sidebar font doesn't update when font
	changed in non-smooth mode) and various other small problems
	with fonts in sidebar. The font in the tabs is still always
	the smooth font.

	Also, made both default smooth and default non-smooth fonts
	visible simultaneously in the Preferences dialog since they
	are both used in different places at the same time. Maybe
	if we fix the sidebar tabs to not insist on using a smooth
	font we can turn these two controls back into one.

	* src/nautilus-preferences-dialog.c: Changed labels from
	"Font for elsewhere in Nautilus", which had become context-free,
	to "Default smooth font" and "Default non-smooth font". Made
	both of these always visible.
	
	* src/nautilus-sidebar-title.c:
	(nautilus_sidebar_title_initialize_class): Set up auto-variable
	to get default non-smooth font name so we don't have to call 
	get_preferences	repeatedly.
	(get_non_smooth_font): New helper function to get a non-smooth
	font of a specified size.
	(non_smooth_font_changed_callback): New function, updates the
	non-smooth font for the title and "more info" text.
	(update_all_cover): Removed this function.
	(nautilus_sidebar_title_initialize): Call new callback instead of
	update_all when non-smooth font changes. update_all was bailing
	out without doing any work since the text hadn't changed. Also
	call callback once to set the initial non-smooth font info.
	(update_title_font): Changed name from update_font for clarity;
	moved some consts to become #defines instead; fixed bug where 
	this routine wasn't using bold font for either smooth or non-smooth 
	font (2 unrelated bugs); removed unnecessary font-setting call 
	(smooth font is already set elsewhere and doesn't change here);
	remove unnecessary callback for NAUTILUS_PREFERENCES_SMOOTH_GRAPHICS_MODE
	since each label piece already handles this separately.
	(update_title), (nautilus_sidebar_title_size_allocate): Updated for
	name change.

2001-04-24  Darin Adler  <darin@eazel.com>

	reviewed by: John Sullivan <sullivan@eazel.com>

	Fix bug where theme selector would not show themes when the theme
	directory is a symlink.
	
	* src/nautilus-theme-selector.c:
	(nautilus_theme_selector_destroy): Small code cleanup.
	(vfs_file_exists): Pass GNOME_VFS_FILE_INFO_FOLLOW_LINKS.
	(populate_list_with_themes_from_directory): Pass
	GNOME_VFS_FILE_INFO_FOLLOW_LINKS.

	More work on making components go away if Nautilus is prematurely
	terminated.

	* src/nautilus-window-toolbars.c:
	(nautilus_window_initialize_toolbars): Don't create a throbber for
	the desktop, since it doesn't get killed reliably since it never
	gets an X window.
	
	* src/nautilus-window.c: (nautilus_window_constructed),
	(nautilus_window_destroy), (nautilus_window_allow_stop): Do some
	minor cleanup of throbber code.

	* nautilus-clean.sh: Add an option to just display the processes
	and not kill them. Useful for me when I'm writing code that's
	designed to make the processes go away. Also remove the gconfd
	saved state file if we kill gconfd (only nautilus-clean.sh -x) for
	maximum cleanliness (but also maximum unhappiness for any
	remaining gconf clients).
	
2001-04-24  John Sullivan  <sullivan@eazel.com>

	reviewed by: Darin Adler  <darin@eazel.com>

	Fixed bug 7650 (Display flashes forever when Text viewer
	used in FTP)

	* components/text/nautilus-text-view.c: (file_read_callback):
	Bail out when bytes_read is 0, instead of trying again forever.
	This happens at EOF.

2001-04-23  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (mark_new_items),
	(rss_read_done_callback):
	when updating, only redraw if something changed
	
2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* src/nautilus-first-time-druid.c:
	(nautilus_first_time_druid_show):
	Remove extra argument to update_draw_desktop_checkbox_state()
	which was declared as () (instead of (void)) before the last
	change and so the build broke.
	
2001-04-23  Darin Adler  <darin@eazel.com>

	reviewed by: John Sullivan <sullivan@eazel.com>
	
	Add a new command-line option "--no-desktop" as requested by
	fcrozat on behalf of people who want to run Nautilus under KDE as
	well as under GNOME. The option has no effect if Nautilus is
	already running, but if it's the first invocation of Nautilus,
	then no desktop-related preferences show up and the desktop is
	not shown regardless of the setting of those preferences.
	
	* src/nautilus-main.c: (main): Add the no-desktop option. Make the
	desktop-related preferences invisible if it's on, and pass it down
	to the NautilusApplication.

	* src/nautilus-application.h:
	* src/nautilus-application.c: (nautilus_application_startup):
	Don't start the desktop if no_desktop is passed in. Otherwise
	decide based on the preference.

	* libnautilus-extensions/nautilus-preferences-box.c:
	(preferences_box_find_row): Mark this private function static.
	(preferences_box_populate_pane): Get rid of code that would
	translate the pane_name twice.
	(nautilus_preferences_dialog_new): Simplified this code a bit.
	
	* libnautilus-extensions/nautilus-preferences.h:
	* libnautilus-extensions/nautilus-preferences.c:
	(preferences_make_user_level_filtered_key),
	(nautilus_preferences_get_is_invisible),
	(nautilus_preferences_set_is_invisible),
	(preferences_key_make_for_getter),
	(nautilus_preferences_visible_in_current_user_level),
	(nautilus_preferences_is_visible): Added new flag to make a
	preference invisible.

	* src/nautilus-first-time-druid.h:
	* src/nautilus-first-time-druid.c: (set_up_gmc_transition_page),
	(nautilus_first_time_druid_show): Removed code that used to make
	the druid default based on the desktop preference.

	Fixed the Tinderbox.

	* libnautilus-extensions/nautilus-global-preferences.c:
	(default_default_folder_viewer_callback): Allow NULL because that
	happens during self-check.

2001-04-23  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (has_matching_uri),
	(compare_channel_names), (nautilus_news_add_channels),
	(add_site_from_fields), (determine_sort_position),
	(add_channel_entry), (make_remove_widgets):
	
	made it maintain the channel lists in alphabetical order, and
	improved uri matching by canonicalizing them before comparison.
		
	* components/news/news_channels.xml:
	added some new channels
	
	* nautilus-spec.in:
	added news panel to spec file.
	
2001-04-23  Andy Hertzfeld  <andy@eazel.com>

	made the disclosure triangles reflect the changed state by using
	different images when the channel changed; currently, I'm using
	placeholder images, but Arlo will give me the real ones soon.
		
	* components/news/nautilus-news-pixmaps.h:
	added images for triangles to reflect the changed state
	* components/news/nautilus-news.c: (do_destroy), (draw_triangle),
	(rss_logo_callback), (nautilus_news_load_images):
	load the new images, release on destroy, and display when appropriate
	
2001-04-23  John Sullivan  <sullivan@eazel.com>

	reviewed by: Darin Adler  <darin@eazel.com>

	Fixed bug 8024 (Default folder viewer chosen from "View As..."
	window is not reflected in Preferences dialog)

	* libnautilus-extensions/nautilus-global-preferences.h:
	Put iids for Icon and List view here since they must be accessed
	from multiple places now. Add NAUTILUS_DEFAULT_FOLDER_VIEWER_OTHER
	enum case. Add prototype for 
	nautilus_global_preferences_set_default_folder_viewer.
	
	* libnautilus-extensions/nautilus-global-preferences.c:
	(get_default_folder_viewer_preference_from_iid): New helper function,
	returns appropriate NAUTILUS_DEFAULT_FOLDER_VIEWER preference value
	based on folder-viewing iid.
	(default_default_folder_viewer_callback): New function to determine
	default value of NAUTILUS_DEFAULT_FOLDER_VIEWER preference; uses
	gnome_vfs_mime (name is not a typo).
	(set_default_folder_viewer_in_gnome_vfs): New function,
	updates gnome-vfs mime database properly for new folder-viewing iid.
	(default_folder_viewer_changed_callback): New function, reacts
	to change in NAUTILUS_DEFAULT_FOLDER_VIEWER preference by updating
	gnome-vfs mime database (moved here from nautilus-application.c).
	(nautilus_global_preferences_set_default_folder_viewer): New public
	function to set the default folder viewer with an iid; handles setting
	both gnome-vfs and gconf's values.
	(nautilus_global_preferences_initialize): Add callback for when
	default folder viewer changes (moved here from nautilus-application.c).
	
	* libnautilus-extensions/nautilus-program-chooser.c:
	(set_default_for_type): Special-case folder viewer to call
	nautilus_global_preferences_set_default_folder_viewer.
	
	* src/file-manager/nautilus-directory-view-ui.xml: Changed
	"Reset to View Preferences" to "Reset View to Match Preferences".
	It's really long, but the former was very unclear. Improvements
	to wording are hereby solicited.
	
	* src/nautilus-application.c: (manufactures), (create_object),
	(default_folder_viewer_changed_callback): Updated for #define
	name changes.
	(nautilus_application_startup): Moved code that reacted to
	default folder viewer preference to nautilus-global-preferences.c.

2001-04-23  John Harper  <jsh@eazel.com>

	* nautilus-clean.sh: added `nautilus-news' to list of auxiliary
	programs

2001-04-23  Darin Adler  <darin@eazel.com>

	* src/nautilus-window-manage-views.c: (open_location): Handle NULL
	case that can happen now that we check the workspace and area --
	the desktop is no longer guaranteed to be in the list considered
	when looking for the topmost window.

2001-04-23  John Harper  <jsh@eazel.com>

	* components/news/nautilus-news.c (set_up_edit_widgets): when
	packing the remove list into its container, use `TRUE, TRUE'
	instead of `FALSE, FALSE'. This makes the `Remove a site' list
	expand properly

2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* libnautilus-extensions/nautilus-preferences-box.c:
	(preferences_box_populate_pane):
	Make sure we use the translated strings for pane and group names.
	
2001-04-23  Darin Adler  <darin@eazel.com>

	Fix bug 7830 (Nautilus should launch programs with code that has
	xalf support [like the panel does]).

	* libnautilus-extensions/nautilus-program-choosing.c:
	(get_xalf_prefix): Implemented, but not tested with xalf.

2001-04-23  John Harper  <jsh@eazel.com>

	* components/news/nautilus-news.c (set_up_configure_widgets):
	don't set the shadow type of the viewport to no shadow. This
	causes a drawing bug to occur, where vestiges of the checkbox
	prelight aren't erased

2001-04-23  Darin Adler  <darin@eazel.com>

	Prep for xalf feature. Add name of program to all code that
	uses the launch_application_from_command function.

	* libnautilus-extensions/nautilus-program-chooser.c:
	(launch_mime_capplet): Pass the file name of the files and
	programs capplet when starting it up. (Is there a better name to
	use for this case?)
	* src/file-manager/fm-desktop-icon-view.c:
	(change_background_callback): Pass "Background" as the name when
	starting the Background capplet.
	* src/file-manager/fm-directory-view.c: (run_script_callback):
	Pass the file name of the script as the name when starting a
	script.
	(activate_callback): Pass the file name of an executable file when
	starting an executable file by opening it.
	
	* libnautilus-extensions/nautilus-program-choosing.h:
	* libnautilus-extensions/nautilus-program-choosing.c:
	(nautilus_launch_application): Pass the application name from the
	gnome-vfs MIME database when starting an application.
	(get_xalf_prefix): Placeholder for code to figure out the right
	set of parameters to pass to xalf.
	(nautilus_launch_application_from_command): Change to take a name
	for the application. It's ignored when xalf is not used, but used
	as the title when xalf is used.

2001-04-23  Darin Adler  <darin@eazel.com>

	Fix bug 8027 (Viewer preferences are not respected).
	
	* src/nautilus-window.c:
	(nautilus_window_handle_ui_event_callback): Check
	updating_bonobo_state and ignore any callbacks while it's true.

2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* test/test-nautilus-preferences-display.c: (main):
	Need to initialize preferences.
	
2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* components/news/Makefile.am:
	Make sure the nautilus-news-pixmaps.h header is exported to the
	dist tarball.
	
2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	Part of bug 7601 - FreeBSD portability fixes.

	* components/music/esd-audio.c: (esdout_loop): Add return NULL to
	make gcc happy.

	* components/music/mpg123.c: (decode_loop): Add return NULL to
	make gcc happy.

	* libnautilus-extensions/nautilus-customization-data.c: Add
	missing include of <stdlib.h>

	* libnautilus-extensions/nautilus-file.c: (group_includes_user):
	Cast the gid to (gid_t)

	* libnautilus-extensions/nautilus-sound.c: Include <wait.h> only
	if we have it.  Otherwise try <sys/wait.h>.

	* src/nautilus-bookmark-parsing.c: Add 	missing include of <stdlib.h>

2001-04-23  Ramiro Estrugo  <ramiro@eazel.com>

	* components/news/Makefile.am:
	Add include flags for for pixmaps in header file included from the
	source directory - which is different from the build directory for
	the tinderbox build.

	* components/news/nautilus-news.c:
	* components/news/nautilus-news-pixmaps.h:
	* components/news/pixmaps.h:
	Rename pixmaps.h to nautilus-news-pixmaps.h to prevent confusion
	in the future.

2001-04-22  Andy Hertzfeld  <andy@eazel.com>

	* components/Makefile.am:
	Josh pointed out that I forgot to add the news component here.
	
2001-04-22  Andy Hertzfeld  <andy@eazel.com>

	implemented change tracking and made the sidebar tab get an
	notification image whenever there's anything new.  Also, improved
	updating and other tweaks.  The news view is pretty much done
	now except for some images from Arlo and lots of testing/debugging.

	* components/news/nautilus-news.c: (get_bonobo_properties),
	(set_bonobo_properties), (nautilus_news_expose_event),
	(nautilus_news_set_prelight_index),
	(nautilus_news_set_news_changed), (clear_channel_changed_flags),
	(nautilus_news_clear_changed_flags), (update_size_and_redraw),
	(has_matching_uri), (mark_new_items), (rss_read_done_callback),
	(nautilus_news_load_channel), (news_get_indicator_image),
	(add_command_buttons), (make_news_view):
	
	* src/nautilus-sidebar.c: (notify_current_sidebar_view),
	(nautilus_sidebar_activate_panel),
	(nautilus_sidebar_deactivate_panel):
	added open/close notifications for sidebar views using
	the bonobo propery bag mechanism
	
2001-04-21  Andy Hertzfeld  <andy@eazel.com>

	implemented the remove command for the news panel, plus
	other clean-ups.
	
	* components/news/nautilus-news.c: (configure_button_clicked),
	(add_site_button_clicked), (add_channel_to_remove_list),
	(add_site_from_fields), (remove_selected_site),
	(add_command_buttons), (add_channel_entry),
	(add_channels_to_lists), (news_label_new),
	(select_row_in_remove_list), (make_remove_widgets),
	(make_add_widgets), (set_up_edit_widgets),
	(set_up_configure_widgets), (make_news_view):

2001-04-21  Andy Hertzfeld  <andy@eazel.com>

	* components/news/nautilus-news.c: (do_destroy), (draw_triangle),
	(draw_rss_logo_image), (is_current_uri), (draw_rss_items),
	(nautilus_news_motion_notify_event), (rss_read_done_callback),
	(make_news_view):

	various improvements to the news view, including Arlofied item positioning,
	prelighting of logos and disclosure triangle, and using bold text
	to indicate the current item instead of a different color.
	
2001-04-20  Gene Z. Ragan  <gzr@eazel.com>

	reviewed by: Darin Adler <darin@eazel.com>

	Fixed bug 8073, roll over Red Hat patches for their
	"plug-n-play" feature to Nautilus.
	
	The code does not use magicdev, but instead uses our
	distribution agnostic volume monitor to achieve identical,
	and in some cases superior, results.
	
	* libnautilus-extensions/nautilus-volume-monitor.c: (floppy_sort),
	(nautilus_volume_monitor_get_target_uri),
	(nautilus_volume_monitor_should_integrate_trash),
	(mount_volume_get_name), (mount_volume_activate),
	(mount_volume_deactivate), (mount_volume_floppy_add),
	(mount_volume_ext2_add), (mount_volume_udf_add),
	(mount_volume_vfat_add), (mount_volume_msdos_add),
	(mount_volume_iso9660_add), (mount_volume_affs_add),
	(mount_volume_auto_add), (mount_volume_cdda_add),
	(mount_volume_fat_add), (mount_volume_hpfs_add),
	(mount_volume_hsfs_add), (mount_volume_minix_add),
	(mount_volume_nfs_add), (mount_volume_proc_add),
	(mount_volume_reiserfs_add), (mount_volume_ufs_add),
	(mount_volume_smb_add), (mount_volume_unsdos_add),
	(mount_volume_xenix_add), (mount_volume_xiafs_add), (find_volumes),
	(create_volume), (copy_volume), (mount_volume_add_filesystem):
	Determine device type when performing volume type specific mount tasks.
	
	* libnautilus-extensions/nautilus-volume-monitor.h:
	Add new device type enumeration.
	
	* src/file-manager/fm-desktop-icon-view.c: (create_mount_link):
	
	* src/nautilus-application.c: (volume_mounted_callback):
	Check for cdroms being mounted and open a window to the cdrom
	mount point if the user has specified that behavior in the
	gnome preferences.

2001-04-20  Ramiro Estrugo  <ramiro@eazel.com>

	* src/nautilus-theme-selector.c:
	Trim down the includes a little bit to only those that are needed.
	
2001-04-20  Ramiro Estrugo  <ramiro@eazel.com>

	* README:
	Update the Mozilla information to point to Taska's support FAQ
	instead of the Nautilus mailing list post.
	
2001-04-20  Andy Hertzfeld  <andy@eazel.com>

	first check-in of "news" sidebar view to display news from selected
	sites that support an rss feed.  It's around 80% completed now, and
	should be quite usable; I just need to finish the remaining 80%.
	
	* components/news/.cvsignore:
	* components/news/Makefile.am:
	* components/news/Nautilus_View_news.oaf.in:
	
	* components/news/nautilus-news.c: (get_bonobo_properties),
	(set_bonobo_properties), (do_destroy), (pixbuf_composite),
	(draw_triangle), (draw_rss_logo_image), (draw_rss_title),
	(draw_rss_items), (nautilus_news_draw_channel),
	(nautilus_news_update_display), (nautilus_news_configure_event),
	(nautilus_news_expose_event), (nautilus_news_set_prelight_index),
	(go_to_uri), (toggle_open_state), (item_hit_test),
	(nautilus_news_button_release_event),
	(nautilus_news_motion_notify_event),
	(nautilus_news_leave_notify_event), (nautilus_news_set_title),
	(free_rss_data_item), (free_rss_channel_items), (free_channel),
	(nautilus_news_free_channel_list), (bool_to_text),
	(nautilus_news_make_channel_document),
	(nautilus_news_save_channel_state), (rss_logo_callback),
	(extract_items), (update_size_and_redraw),
	(rss_read_done_callback), (nautilus_news_load_channel),
	(nautilus_news_make_new_channel), (nautilus_news_add_channels),
	(get_xml_path), (read_channel_list), (check_for_updates),
	(news_get_indicator_image), (load_xpm_image),
	(nautilus_news_load_images), (configure_button_clicked),
	(add_site_button_clicked), (add_site_from_fields),
	(add_command_buttons), (get_channel_from_name),
	(check_button_toggled_callback), (nautilus_news_load_location),
	(add_channel_entry), (add_channels_to_configure_list),
	(set_up_add_widgets), (set_up_configure_widgets),
	(set_up_main_widgets), (make_news_view), (main):
	
	* components/news/news_bullet.png:
	* components/news/news_channels.xml:
	* components/news/pixmaps.h:
	* configure.in:

2001-04-20  Ramiro Estrugo  <ramiro@eazel.com>

	* ChangeLog: rolled over to ChangeLog-20010420.
